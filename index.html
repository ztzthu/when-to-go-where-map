<!DOCTYPE html>
<html>
<head>
    <title>When-to-go-where Map : Visualization of the best travel month</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
    crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
        integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
        crossorigin="">
    </script>
    <style>
        #map { width: 100%; height: 1200px; margin-top: 1.5em;}
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
    </style>
</head>
<body>

<h4>‚òÄÔ∏èüåßÔ∏èü•∂ü•µ The when-to-go-where map: a visualization of the best month of travel</h4>

We use <a href="https://www.nature.com/articles/s41597-020-0453-3">CRU TS 4.0</a> monthly high-resolution climate dataset to help you find out the best month of travel. 

<br><br>

<b>Methodology</b>: Four factors are considered and used to calculate an <b>absolute score</b> for each month: <br>
1Ô∏è‚É£ Wet days (20%), the less the better; <br>
2Ô∏è‚É£ Percipitation (30%), the less the better; <br>
3Ô∏è‚É£ Maximum temperature (30%), full score when less than 30 degrees; <br>
4Ô∏è‚É£ Minimum temperature, full score when more than 10 degrees. <br>

<br>

For each place, the 12 absolute scores are normalized a <b>relative score</b> in [0,100]. In the map we always show this relative score ! 

<br><br>

Pro tips: click on a place to show the relative score ! üëá
<br>

<div id="map"></div>

<!-- <script src="../node_modules/simpleheat/simpleheat.js"></script>
<script src="../src/HeatLayer.js"></script> -->

<!-- CDN references -->

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://npmcdn.com/geotiff@0.3.6/dist/geotiff.js"></script> <!-- optional -->

<!-- Plugin -->
<script src="https://ihcantabria.github.io/Leaflet.CanvasLayer.Field/dist/leaflet.canvaslayer.field.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>

<script src="./data/absolute_1.js"></script>


<!-- Create a map -->

<script>

  // Basemap
  var map = L.map("map").setView([50, 20], 4);
  var url = 'https://stamen-tiles.a.ssl.fastly.net/toner/{z}/{x}/{y}.png';
  L.tileLayer(url, {
    attribution: "OSM & Carto",
    subdomains: "abcd",
    maxZoom: 16
  }).addTo(map);


  // Layer Control
//   var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
//   var baseMaps = {
//     "<span style='color: gray'>Grayscale</span>": grayscale,
//     "Streets": streets
//   };

  // GeoTIFF
  var tiff = "./data/relative_7.tif";



  d3.request(tiff).responseType('arraybuffer').get(
            function (error, tiffData) {
                let s = L.ScalarField.fromGeoTIFF(tiffData.response);

                let relative_1 = L.canvasLayer.scalarField(s, {
                    opacity: 0.7,
                    color: chroma.scale('YlOrRd').domain(s.range),
                }).addTo(map);

                relative_1.on('click', function (e) {
                    if (e.value !== null) {
                        let v = e.value.toFixed(2);
                        let html = (`<span class="popupText">Score ${v}</span>`);
                        let popup = L.popup()
                            .setLatLng(e.latlng)
                            .setContent(html)
                            .openOn(map);
                    }
                });
                // map.fitBounds(layer.getBounds());




                // Layer Control
                L.control.layers({
                    "July": relative_1,
                    "August": relative_1
                }, {}, {
                    position: 'topright',
                    collapsed: false
                    }).addTo(map);


            });
  




  // d3.request(tiff).responseType('arraybuffer').get(
  //   function(error, tiffData) {
  //     var s = L.ScalarField.fromGeoTIFF(buffer);
  //     let layer = L.canvasLayer.scalarField(s, {
  //       color: chroma.scale('OrRd').domain(s.range),
  //       opacity: 0.7,
  //       interpolate: false,
  //       mouseMoveCursor: null,
  //   }).addTo(map);


  //   // Add score info panel

  //   var info = L.control();

  //   info.onAdd = function (map) {
  //       this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
  //       this.update();
  //       return this._div;
  //   };

  //   // method that we will use to update the control based on feature properties passed
  //   info.update = function (props) {
  //       this._div.innerHTML = '<h4>Relative score</h4>' +  (props!=null ?
  //           props
  //           : 'Hover over a state');
  //   };

  //   info.addTo(map);


  //   layer.on("click", function(e){
  //     if (e.value!=null){
  //       info.update(e.value);
  //     }
  //   })


  //   // map.fitBounds(layer.getBounds());
  // });

</script>

</body>
</html>